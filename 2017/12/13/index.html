<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>还在用虚拟机吗，是时候用Docker了 | 程鹏飞的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Docker是啥？如果有人问起了你这个问题，你可以这样回答他：Docker就是一个轻量型的虚拟机，可以充分利用服务器性能。 如果你的这个回答被怼了？  爱怼怼用户A：什么轻量型的虚拟机，跟虚拟机本质上是有区别的好吧？虚拟机多了一层guest OS，同时Hypervisor会对硬件资源进行虚拟化，运行在虚拟机上的应用程序在进行数值计算时是运行在Hypervisor虚拟的CPU上的（如果你使用过win">
<meta property="og:type" content="article">
<meta property="og:title" content="还在用虚拟机吗，是时候用Docker了">
<meta property="og:url" content="https://michaelooo.github.io/2017/12/13/index.html">
<meta property="og:site_name" content="程鹏飞的博客">
<meta property="og:description" content="Docker是啥？如果有人问起了你这个问题，你可以这样回答他：Docker就是一个轻量型的虚拟机，可以充分利用服务器性能。 如果你的这个回答被怼了？  爱怼怼用户A：什么轻量型的虚拟机，跟虚拟机本质上是有区别的好吧？虚拟机多了一层guest OS，同时Hypervisor会对硬件资源进行虚拟化，运行在虚拟机上的应用程序在进行数值计算时是运行在Hypervisor虚拟的CPU上的（如果你使用过win">
<meta property="og:locale" content="zh_ZN">
<meta property="article:published_time" content="2017-12-13T13:54:00.000Z">
<meta property="article:modified_time" content="2023-03-01T10:50:12.644Z">
<meta property="article:author" content="Michael Cheng">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="持续集成">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="https://ws1.sinaimg.cn/large/86c7c947gy1g4sl65dqrtj20b40b478p.jpg">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://michaelooo.github.io"></form></div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
        <a class="main-nav-link" href="/">首页</a>
        
        <a class="main-nav-link" href="/archives">归档</a>
        
        <a class="main-nav-link" href="/resume/">关于</a>
        
      </nav>
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">程鹏飞的博客</a>
      </h1>
      
    </div>
  </div>
  <!-- <script src="https://releases.leanapp.cn/leancloud/javascript-sdk/releases/download/v3.5.0/av-min.js"></script> -->
</header>

      <div class="outer">
        <section id="main"><article id="post-是时候开始用Docker了" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/13/" class="article-date">
  <time datetime="2017-12-13T13:54:00.000Z" itemprop="datePublished">2017-12-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      还在用虚拟机吗，是时候用Docker了
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="Docker是啥？"><a href="#Docker是啥？" class="headerlink" title="Docker是啥？"></a><strong>Docker是啥？</strong></h2><p>如果有人问起了你这个问题，你可以这样回答他：<strong>Docker就是一个轻量型的虚拟机，可以充分利用服务器性能。</strong></p>
<p>如果你的这个回答被怼了？</p>
<ul>
<li><p>爱怼怼用户A：什么轻量型的虚拟机，跟虚拟机本质上是有区别的好吧？虚拟机多了一层guest OS，同时Hypervisor会对硬件资源进行虚拟化，运行在虚拟机上的应用程序在进行数值计算时是运行在Hypervisor虚拟的CPU上的（如果你使用过win10的hyper-v虚拟机工具，你就会发现如果要开启虚拟机就要在bios开启cpu的虚拟化）。而docker直接使用硬件资源虚拟机增加了一层虚拟硬件层，所以资源利用率相对docker低。</p>
</li>
<li><p>爱怼怼用户B： Docker其实也是类似于虚拟机的。至少在作用目的上是一致的。用一个“经典”的例子来作对比就是：将部署应用比作鸣人来搓螺旋丸，虚拟机类似于鸣人的影分身之术，每个分身（虚拟机）都拥有同样的身体（OS，环境）,但是在查克拉（CPU）的使用上，每个分身的查克拉会均分自真身（真正的主机），这个行为也可以称之为CPU虚拟化，但是这里浪费了分身，用分身来搓一个小螺旋丸，太浪费了……而对于docker来说，就像是九尾模式的鸣人，我直接利用我体内的九尾查克拉（硬件资源），分成九只爪子，每只爪子相互独立，也可以搓小螺旋丸……</p>
</li>
<li><p>爱怼怼用户C： 楼上菜鸡，直接看官方介绍不就行了，<a target="_blank" rel="noopener" href="https://www.docker.com/what-docker">Docker官方介绍</a>，<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/22871084/answer/88293837">Docker集装箱</a></p>
</li>
<li><p>……</p>
</li>
</ul>
<p>对于这些，你只需回答：看来你不是都知道么……</p>
<p>那么使用Docker有哪些好处呢?</p>
<h2 id="用Docker有啥好处？"><a href="#用Docker有啥好处？" class="headerlink" title="用Docker有啥好处？"></a><strong>用Docker有啥好处？</strong></h2><ul>
<li>速度飞快以及优雅的隔离框架： 每个Docker之间互相隔离。</li>
<li>物美价廉： 服务器一台多贵晓得不，省了不少经费了。</li>
<li>CPU&#x2F;内存的低消耗：少了大部分虚拟机的没太大作用的硬件资源占用，自然消耗少了。  </li>
<li>快速开&#x2F;关机： 相对于虚拟机肉鸡开机速度而言。</li>
<li>跨云计算基础构架： 就是云计算喽。</li>
</ul>
<h2 id="简单操作：搭建-Docker-环境"><a href="#简单操作：搭建-Docker-环境" class="headerlink" title="简单操作：搭建 Docker 环境"></a><strong>简单操作：搭建 Docker 环境</strong></h2><p>以下上手基于 <strong>CentOS</strong> ，所以你首先需要一个Linux的系统主机。</p>
<h4 id="安装与配置-Docker"><a href="#安装与配置-Docker" class="headerlink" title="安装与配置 Docker"></a><strong>安装与配置 Docker</strong></h4><p><strong>安装 Docker</strong></p>
<p>Docker 软件包已经包括在默认的 CentOS-Extras 软件源里。因此想要安装 docker，只需要运行下面的 yum 命令：</p>
<pre><code>yum install docker-io -y
直接yum安装，安装成功后查看版本

docker -v
启动docker

service docker start
设置开机启动

chkconfig docker on
配置 Docker
</code></pre>
<p>因为国内访问 Docker Hub 较慢, 可以使用腾讯云提供的国内镜像源, 加速访问 Docker Hub</p>
<p>依次执行以下命令</p>
<pre><code>echo &quot;OPTIONS=&#39;--registry-mirror=https://mirror.ccs.tencentyun.com&#39;&quot; &gt;&gt; /etc/sysconfig/docker

systemctl daemon-reload

service docker restart
</code></pre>
<h4 id="Docker-上手"><a href="#Docker-上手" class="headerlink" title="Docker 上手"></a><strong>Docker 上手</strong></h4><p><strong>下载镜像</strong></p>
<pre><code>下载一个官方的 CentOS 镜像到本地

docker pull centos
下载好的镜像就会出现在镜像列表里

docker images
运行容器
</code></pre>
<p>这时我们可以在刚才下载的 <strong>CentOS</strong> 镜像生成的容器内操作了。</p>
<p>生成一个 centos 镜像为模板的容器并使用 bash shell</p>
<pre><code>docker run -it centos /bin/bash
</code></pre>
<p>这个时候可以看到命令行的前端已经变成了 <code>[root@(一串 hash Id)]</code> 的形式, 这说明我们已经成功进入了 CentOS 容器。</p>
<p>在容器内执行任意命令, 不会影响到宿主机, 如下</p>
<pre><code>mkdir -p /data/simple_docker
可以看到 /data 目录下已经创建成功了 simple_docker 文件夹

ls /data
退出容器

exit
查看宿主机的 /data 目录, 并没有 simple_docker 文件夹, 说明容器内的操作不会影响到宿主机

ls /data
保存容器

查看所有的容器信息， 能获取容器的id

docker ps -a
然后执行如下命令[?]，保存镜像：

docker commit -m=&quot;备注&quot; 你的CONTAINER_ID 你的IMAGE

请自行将 -m 后面的信息改成自己的容器的信息
</code></pre>
<p><strong>Docker容器的基本操作</strong></p>
<pre><code>docker [命令名] --help 查看命令介绍
docker run 创建并启动一个容器，在run后面加上-d参数，则会创建一个守护式容器在后台运行。
docker ps -a 查看已经创建的容器
docker ps -s 查看已经启动的容器
docker start con_name 启动容器名为con_name的容器
docker stop con_name 停止容器名为con_name的容器
docker rm con_name 删除容器名为con_name的容器
docker rename old_name new_name 重命名一个容器
docker attach con_name 将终端附着到正在运行的容器名为con_name的容器的终端上面去，前提是创建该容器时指定了相应的sh
执行这个命令后，按下回车键，会进入容器的命令行Shell中。
docker logs con_name 获取容器名为con_name的容器日志
docker inspect 查看容器的详细信息
docker top con_name 查看容器名为con_name的容器内部的进程
docker exec 可以用来在容器中运行一个进程
</code></pre>
<p><strong>Docker的详细操作</strong></p>
<p>不造轮子，<a target="_blank" rel="noopener" href="http://www.runoob.com/docker/docker-container-usage.html">请戳菜鸟教程。</a></p>
<p><strong>shell脚本部署到Docker的一个小栗子</strong></p>
<blockquote>
<p>参考链接：</p>
</blockquote>
<blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000004491286">docker清理镜像</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.51cto.com/onlyzq/546459">在Linux中让echo命令显示带颜色的字。</a></li>
</ul>
</blockquote>
<ul>
<li><code>echo -e &quot;\033[40;37m 黑底白字 \033[0m&quot;</code> 此方法是输入带上颜色</li>
<li>清理镜像的操作是一系列的。具体情况具体分析。例如另一个例子：</li>
<li><code>$ docker ps --filter &quot;status=exited&quot; | grep &#39;weeks ago&#39; | awk &#39;&#123;print $1&#125;&#39; | xargs --no-run-if-empty docker rm</code>，来自<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/17236796/how-to-remove-old-docker-containers">How to remove old Docker containers</a> </li>
<li><code>awk</code>是一个文本分析工具，找出文本指定位置的内容并print出来（解释不当）</li>
</ul>
<pre><code># 声明变量
SERVER_HOST=&quot;root@xx.x.xxx.xx&quot;
SERVER_PATH=&quot;/home/test/src&quot;
BUILD_TIME=`date &quot;+%Y%m%d%H%M&quot;`
IMAGE_NAME=&quot;xxxx(docker镜像)&quot;

# 传输之后特殊文件的修改
rsync -cavzP --delete-after ./ --exclude-from=&#39;.rsync-exclude&#39; $SERVER_HOST:$SERVER_PATH
rsync -cavzP --delete-after ./node_modules/ftp-client $SERVER_HOST:$SERVER_PATH/node_modules


ssh $SERVER_HOST &quot;\
  cd $SERVER_PATH; \
  echo &quot;安装依赖&quot;; \
  npm install; \
  echo &quot;清理过时的测试镜像&quot;; \
  docker images | awk &#39;&#123; print \$3 &#125;&#39; | xargs docker rmi ; \
  echo &quot;构建docker镜像 $IMAGE_NAME&quot;; \
  docker build -t $MAGE_NAME . ;\
  echo &quot;发布docker镜像&quot;; \
  docker push $IMAGE_NAME ;\
  exit; \
  &quot;

echo &quot;\033[40;32m\n&quot;
echo &quot;Sync to Server: $MARKET_SERVER_HOST&quot;
echo &quot;Build source code path: $MARKET_SERVER_PATH&quot;
echo &quot;Image: $MARKET_IMAGE_NAME&quot;
echo &quot;Image deploy success&quot;
echo &quot;\033[0m&quot;
</code></pre>
<h2 id="Docker实践，利用DaoCloud来部署应用"><a href="#Docker实践，利用DaoCloud来部署应用" class="headerlink" title="Docker实践，利用DaoCloud来部署应用"></a><strong>Docker实践，利用DaoCloud来部署应用</strong></h2><p>该部分内容过多，请直接参考我的另一篇博客：<a target="_blank" rel="noopener" href="http://blog.csdn.net/u013707249/article/details/78801575">Docker实践，利用DaoCloud来部署应用</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://michaelooo.github.io/2017/12/13/" data-id="clepk3zv80029gtnd9mxe9bai" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" rel="tag">持续集成</a></li></ul>

    </footer>
  </div>
  
    
 
<script src="/jquery/jquery.min.js"></script>

  <div id="random_posts">
    <h2>推荐文章</h2>
    <div class="random_posts_ul">
      <script>
          var random_count =4
          var site = {BASE_URI:'/'};
          function load_random_posts(obj) {
              var arr=site.posts;
              if (!obj) return;
              // var count = $(obj).attr('data-count') || 6;
              for (var i, tmp, n = arr.length; n; i = Math.floor(Math.random() * n), tmp = arr[--n], arr[n] = arr[i], arr[i] = tmp);
              arr = arr.slice(0, random_count);
              var html = '<ul>';
            
              for(var j=0;j<arr.length;j++){
                var item=arr[j];
                html += '<li><strong>' + 
                item.date + ':&nbsp;&nbsp;<a href="' + (site.BASE_URI+item.uri) + '">' + 
                (item.title || item.uri) + '</a></strong>';
                if(item.excerpt){
                  html +='<div class="post-excerpt">'+item.excerpt+'</div>';
                }
                html +='</li>';
                
              }
              $(obj).html(html + '</ul>');
          }
          $('.random_posts_ul').each(function () {
              var c = this;
              if (!site.posts || !site.posts.length){
                  $.getJSON(site.BASE_URI + 'js/posts.js',function(json){site.posts = json;load_random_posts(c)});
              } 
               else{
                load_random_posts(c);
              }
          });
      </script>
    </div>
  </div>

    
<nav id="article-nav">
  
    <a href="/2017/12/14/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          Docker实践，利用DaoCloud来部署应用
        
      </div>
    </a>
  
  
    <a href="/2017/12/12/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">高性能打包工具：Webpack 对比 Parcel</div>
    </a>
  
</nav>

  
</article>
 
     
<div class="comments" id="comments">
      
</div>


  

</section>
           
    <aside id="sidebar">
  
    

  
    
    <div class="widget-wrap">
    
      <div class="widget" id="toc-widget-fixed">
      
        <strong class="toc-title">文章目录</strong>
        <div class="toc-widget-list">
              <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E6%98%AF%E5%95%A5%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">Docker是啥？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8Docker%E6%9C%89%E5%95%A5%E5%A5%BD%E5%A4%84%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">用Docker有啥好处？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C%EF%BC%9A%E6%90%AD%E5%BB%BA-Docker-%E7%8E%AF%E5%A2%83"><span class="toc-number">3.</span> <span class="toc-text">简单操作：搭建 Docker 环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE-Docker"><span class="toc-number">3.0.1.</span> <span class="toc-text">安装与配置 Docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-%E4%B8%8A%E6%89%8B"><span class="toc-number">3.0.2.</span> <span class="toc-text">Docker 上手</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E5%AE%9E%E8%B7%B5%EF%BC%8C%E5%88%A9%E7%94%A8DaoCloud%E6%9D%A5%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">Docker实践，利用DaoCloud来部署应用</span></a></li></ol>
          </div>
      </div>
    </div>

  
    

  
    
  
    
  
    

  
    
  
    <!--微信公众号二维码-->


  
    <!-- 去掉浏览量统计 -->
<!-- 
    <div class="widget-wrap">
    <h3 class="widget-title">浏览数目</h3>
    <div class="widget">
      <ul class="popularlist">
      </ul>
    </div>
  </div>
 -->
  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2023 Michael Cheng&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
      <a target="_blank" href="http://www.beian.miit.gov.cn/" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;margin-left: 10px;">
          <img style="float: left; width: 20px;" src="//img.alicdn.com/tfs/TB1..50QpXXXXX7XpXXXXXXXXXX-40-40.png">
          <span style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">粤ICP备17162335号</span>
      </a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;422208170@qq.com
    </div>
  </div>
</footer>
 
<script src="/jquery/jquery.min.js"></script>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/resume/" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="https://t1.picb.cc/uploads/2021/05/04/ZEnbna.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
     
<script src="/js/is.js"></script>



  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


<script src="/js/elevator.js"></script>


<script src="/js/fundebug.1.9.0.min.js"></script>


<!--page counter part-->
<script>
  function addCount (Counter) {
    var curpage_count; 
    url=$('.article-date').attr('href').trim();
    title = $('.article-title').text().trim();
    var query=new AV.Query(Counter);
    //use url as unique idnetfication
    query.equalTo("url",url);
    query.find().then(function(results){
      if(results.length>0) {
          var counter=results[0];
          counter.fetchWhenSave(true); //get recent result
          counter.increment("time");
          counter.save();
          curpage_count = counter.attributes.time + 1;
          $('.article-inner').append('<p style="color:#999;margin-left:20px">（本文已被访问'+curpage_count+'次）</p>');
      } else {
        var newcounter=new Counter();
        newcounter.set("title",title);
        newcounter.set("url",url);
        newcounter.set("time",1);
        newcounter.save(null,{
            success: function(newcounter){
            //alert('New object created');
            },
            error: function(newcounter,error){
            alert('Failed to create');
            }
            });
        curpage_count = 1;
        $('.article-inner').append('<p style="color:#999;margin-left:20px">（本文已被访问'+curpage_count+'次）</p>');
      }
    },function(error){
        //find null is not a error
        alert('Error:'+error.code+" "+error.message);
    });
  }

  $(function(){
      // fundebug INIT
      fundebug.apikey = '311c1dc8f056512d95a8a459b5d14892078dc69e4686b5f704142485c2c04620';

      // init
      var APP_ID = 'P8zI4n1RVVKeFqFoDDcJXtxB-gzGzoHsz';
      var APP_KEY = 'XygRBwRtUGj8XJLClnpGKXQQ';

      AV.init({
        appId: APP_ID,
        appKey: APP_KEY
      });

      var Counter=AV.Object.extend("Counter");
      //only increse visit counting when intering a page
      if ($('.article-title').length == 1)
        addCount(Counter);
      var query=new AV.Query(Counter);
      query.descending("time");
      // the sum of popular posts
      query.limit(10); 
      query.find()
      .then(
        function(results){
          for(var i=0;i<results.length;i++)    
            {
                var counter=results[i];
                title=counter.get("title");
                url=counter.get("url");
                time=counter.get("time");
                // add to the popularlist widget
                showcontent=title+" ("+time+")";
                //notice the "" in href
                $('.popularlist').append('<li><a href="'+url+'">'+showcontent+'</a></li>');
            }
          },
          function(error){
            alert("Error:"+error.code+" "+error.message);
          });
  });
</script>

  </div>
</body>
</html>